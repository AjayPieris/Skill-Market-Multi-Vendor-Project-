// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// 1. THE USER (Can be Admin, Vendor, or Customer)
model User {
  id        String   @id @default(uuid()) // Unique ID like "a1b2-c3d4"
  email     String   @unique
  clerkId   String   @unique // We will link this to authentication later
  name      String?
  bio       String?  // For vendors (e.g. "I am an expert designer")
  image     String?  // Profile picture URL
  
  role      String   @default("customer") // "admin", "vendor", or "customer"

  gigs      Gig[]    // A User (Vendor) can own many Gigs
  orders    Order[]  // A User (Customer) can have many Orders
  createdAt DateTime @default(now())

  conversationsInitiated Conversation[] @relation("UserOne")
  conversationsReceived  Conversation[] @relation("UserTwo")
  messages               Message[]
}

// 2. THE GIG (The Service being sold)
model Gig {
  id          String   @id @default(uuid())
  title       String
  description String
  price       Int
  imageUrl    String   // Thumbnail for the gig
  category    String   // e.g. "Design", "Web Dev"

  // RELATIONSHIP: A Gig belongs to ONE Vendor (User)
  vendorId    String
  vendor      User     @relation(fields: [vendorId], references: [id])

  orders      Order[]  // A Gig can have many Orders

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// NEW: The Order Model
model Order {
  id        String   @id @default(uuid())
  price     Int      // Price paid at that time
  status    String   @default("pending") // pending, completed
  
  // Who bought it?
  buyerId   String
  buyer     User     @relation(fields: [buyerId], references: [id])

  // What did they buy?
  gigId     String
  gig       Gig      @relation(fields: [gigId], references: [id])

  createdAt DateTime @default(now())
}

model Conversation {
  id        String   @id @default(uuid())
  
  userOneId String
  userOne   User     @relation("UserOne", fields: [userOneId], references: [id])
  
  userTwoId String
  userTwo   User     @relation("UserTwo", fields: [userTwoId], references: [id])

  messages  Message[]

  // Ensures these two people only have ONE conversation together
  @@unique([userOneId, userTwoId]) 
}

model Message {
  id             String       @id @default(uuid())
  content        String
  imageUrl       String?
  
  // NEW FIELD:
  isRead         Boolean      @default(false)

  conversationId String
  conversation   Conversation @relation(fields: [conversationId], references: [id])
  
  senderId       String
  sender         User         @relation(fields: [senderId], references: [id])

  createdAt      DateTime     @default(now())
}